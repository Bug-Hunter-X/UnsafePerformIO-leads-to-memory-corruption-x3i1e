The solution involves refactoring the code to avoid the use of `unsafePerformIO`.  Instead, we'll use monadic operations to manage side effects in a controlled and safe manner. This example shows how to correctly handle the I/O operation and preserve the purity of Haskell.  If the operation needs to deal with external resources, using a safe I/O operation and handling the state properly is recommended.